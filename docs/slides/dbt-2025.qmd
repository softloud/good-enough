---
format: 
  revealjs:
    theme: solarized
    code-fold: true
    echo: true

title: "ESG Data Governance & Living Analysis Lifescycle"
subtitle: DBT Copenhagen Meetup
date: Wednesday 26 March 2025
bibliography: ../singularities.bib
html-math-method: mathml
author: Charles T. Gray, PhD -- Datapunk
---

# Tests

## Test: generator $\to$ display

*Test the functor between visualisation generator and slide display.*

Where am I? 

```{r}
getwd()

```

What am I testing?
```{bash}
cat R/test-mooncake.R

```

Source & Print it
```{r}

source("R/test-mooncake.R")

# Print it 
mooncake_test
```

## Test: FAIR data entity test

*Identity test on edge object.*

Can we validate a single datum? 

> I expect there to be a node `ingest` that goes to a node `transform` representing `data engineering` tasks in the `expected` instance of living analysis lifecycle.

## Test: failed FAIR data entity test

### Expectations

```{r}


# Create the expected datum for testing
# Expecting an edge from "ingest" to "transform" as part of the "data engineering" process

(
  expected_datum <- data.frame(
    from = "ingest",
    to = "transform",
    node_type = "data engineering"
  )
)
```

## Test: failed FAIR data entity test

### Check the edges are non-empty

```{r error=TRUE}


# source generator
source("R/ButtonCategory.R")

# generate button graph
anal_beads <- 
  ButtonCategory$new()

# Get this test to pass on edges

# non-empty intersection
nrow(
  anal_beads$edges |>
  dplyr::inner_join(expected_datum)
) > 0

```

## Test: failed FAIR data entity test

### Check the column names are as expected 

> Role is a node attribute! 


```{r}


# show expected
expected_datum

# exact columns
all(
  colnames(expected_datum) %in% colnames(anal_beads$edges)
)

# show edges
head(anal_beads$edges, 3)
```

## Test: FAIR data entity test

### Expectations

Expected edges.

```{r}


# Create the expected datum for testing
# Expecting an edge from "ingest" to "transform" as part of the "data engineering" process

(
  expected_edge <- data.frame(
    from = "ingest",
    to = "transform"
  )
)

```

Expected nodes.

```{r}
# create expected nodes

(
  expected_nodes <- data.frame(
    name = c("ingest", "transform")
  ) |>
    dplyr::mutate(role = "data engineering")
)

```

## Test: FAIR data entity test

### Check the edges are non-empty

```{r error=TRUE}


# source generator
source("R/ButtonCategory.R")

# generate button graph
anal_beads <- 
  ButtonCategory$new()

# Get this test to pass on edges

# non-empty intersection
nrow(
  anal_beads$edges |>
  dplyr::inner_join(expected_datum)
) > 0

```

## Test: FAIR data entity test

### Check the column names are as expected 

> Role is a node attribute! 


```{r}


# show expected
expected_datum

# exact columns
all(
  colnames(expected_datum) %in% colnames(anal_beads$edges)
)

# show edges
head(anal_beads$edges, 3)
```

